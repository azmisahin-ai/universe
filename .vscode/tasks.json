{
  "version": "2.0.0",
  "tasks": [
    {
      "type": "cppbuild",
      "label": "C/C++: gcc build active file",
      "command": "/usr/bin/gcc",
      "args": [
        "-fdiagnostics-color=always",
        "-g",
        "${file}",
        "-o",
        "${workspaceFolder}/build/debug/linux_64/${fileBasenameNoExtension}"
      ],
      "options": {
        "cwd": "${fileDirname}"
      },
      "problemMatcher": ["$gcc"],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "detail": "Task generated by Debugger."
    },

    {
      "label": "arch_linux_64",
      "dependsOrder": "sequence",
      "dependsOn": [
        "arch_linux_64_create",
        "arch_linux_64_compile",
        "arch_linux_64_link"
      ]
    },
    {
      "label": "arch_linux_64_create",
      "type": "shell",
      "command": "mkdir",
      "args": ["-p", "${workspaceFolder}/build/debug/linux_64"],
      "presentation": {
        "focus": true,
        "panel": "shared",
        "reveal": "silent",
        "clear": true
      }
    },
    {
      "label": "arch_linux_64_compile",
      "type": "shell",
      "command": "nasm",
      "args": [
        "-f",
        "elf64",
        "-gcv8",
        "-o",
        "${workspaceFolder}/build/debug/linux_64/${fileBasenameNoExtension}.o",
        "-MD",
        "${workspaceFolder}/build/debug/linux_64/${fileBasenameNoExtension}.o.dep",
        "-l",
        "${workspaceFolder}/build/debug/linux_64/${fileBasenameNoExtension}.o.lst",
        "-F",
        "dwarf",
        "-g",
        "-Dlinux_64",
        "${file}"
      ],
      "problemMatcher": {
        "pattern": {
          "regexp": "error"
        }
      }
    },
    {
      "label": "arch_linux_64_link",
      "type": "shell",
      "command": "ld",
      "args": [
        "-m",
        "elf_x86_64",
        "-o",
        "${workspaceFolder}/build/debug/linux_64/${fileBasenameNoExtension}",
        "${workspaceFolder}/build/debug/linux_64/${fileBasenameNoExtension}.o"
      ],
      "problemMatcher": {
        "pattern": {
          "regexp": "error"
        }
      }
    },

    {
      "label": "arch_linux_32",
      "dependsOrder": "sequence",
      "dependsOn": [
        "arch_linux_32_create",
        "arch_linux_32_compile",
        "arch_linux_32_link"
      ]
    },
    {
      "label": "arch_linux_32_create",
      "type": "shell",
      "command": "mkdir",
      "args": ["-p", "${workspaceFolder}/build/debug/linux_32"],
      "presentation": {
        "focus": true,
        "panel": "shared",
        "reveal": "silent",
        "clear": true
      }
    },
    {
      "label": "arch_linux_32_compile",
      "type": "shell",
      "command": "nasm",
      "args": [
        "-f",
        "elf32",
        "-gcv8",
        "-o",
        "${workspaceFolder}/build/debug/linux_32/${fileBasenameNoExtension}.o",
        "-MD",
        "${workspaceFolder}/build/debug/linux_32/${fileBasenameNoExtension}.o.dep",
        "-l",
        "${workspaceFolder}/build/debug/linux_32/${fileBasenameNoExtension}.o.lst",
        "-F",
        "dwarf",
        "-g",
        "-Dlinux_32",
        "${file}"
      ],
      "problemMatcher": {
        "pattern": {
          "regexp": "error"
        }
      }
    },
    {
      "label": "arch_linux_32_link",
      "type": "shell",
      "command": "ld",
      "args": [
        "-m",
        "elf_i386",
        "-o",
        "${workspaceFolder}/build/debug/linux_32/${fileBasenameNoExtension}",
        "${workspaceFolder}/build/debug/linux_32/${fileBasenameNoExtension}.o"
      ],
      "problemMatcher": {
        "pattern": {
          "regexp": "error"
        }
      }
    },

    {
      "label": "arch_win_64",
      "dependsOrder": "sequence",
      "dependsOn": [
        "arch_win_64_create",
        "arch_win_64_compile",
        "arch_win_64_link"
      ]
    },
    {
      "label": "arch_win_64_create",
      "type": "shell",
      "command": "mkdir",
      "args": ["-p", "${workspaceFolder}/build/debug/win_64"],
      "presentation": {
        "focus": true,
        "panel": "shared",
        "reveal": "silent",
        "clear": true
      }
    },
    {
      "label": "arch_win_64_compile",
      "type": "shell",
      "command": "nasm",
      "args": [
        "-f",
        "win64",
        "-gcv8",
        "-o",
        "${workspaceFolder}/build/debug/win_64/${fileBasenameNoExtension}.obj",
        "-MD",
        "${workspaceFolder}/build/debug/win_64/${fileBasenameNoExtension}.o.dep",
        "-l",
        "${workspaceFolder}/build/debug/win_64/${fileBasenameNoExtension}.o.lst",
        "-Dwin_64",
        "${file}"
      ],
      "problemMatcher": {
        "pattern": {
          "regexp": "error"
        }
      }
    },
    {
      "label": "arch_win_64_link",
      "type": "shell",
      "command": "i686-w64-mingw32-ld",
      "args": [
        "-o",
        "${workspaceFolder}/build/debug/win_64/${fileBasenameNoExtension}.exe",
        "${workspaceFolder}/build/debug/win_64/${fileBasenameNoExtension}.obj"
      ],
      "problemMatcher": {
        "pattern": {
          "regexp": "error"
        }
      }
    },

    {
      "label": "arch_win_32",
      "dependsOrder": "sequence",
      "dependsOn": [
        "arch_win_32_create",
        "arch_win_32_compile",
        "arch_win_32_link"
      ]
    },
    {
      "label": "arch_win_32_create",
      "type": "shell",
      "command": "mkdir",
      "args": ["-p", "${workspaceFolder}/build/debug/win_32"],
      "presentation": {
        "focus": true,
        "panel": "shared",
        "reveal": "silent",
        "clear": true
      }
    },
    {
      "label": "arch_win_32_compile",
      "type": "shell",
      "command": "nasm",
      "args": [
        "-f",
        "win32",
        "-gcv8",
        "-o",
        "${workspaceFolder}/build/debug/win_32/${fileBasenameNoExtension}.obj",
        "-MD",
        "${workspaceFolder}/build/debug/win_32/${fileBasenameNoExtension}.o.dep",
        "-l",
        "${workspaceFolder}/build/debug/win_32/${fileBasenameNoExtension}.o.lst",
        "-Dwin_32",
        "${file}"
      ],
      "problemMatcher": {
        "pattern": {
          "regexp": "error"
        }
      }
    },
    {
      "label": "arch_win_32_link",
      "type": "shell",
      "command": "i686-w64-mingw32-ld",
      "args": [
        "-o",
        "${workspaceFolder}/build/debug/win_32/${fileBasenameNoExtension}.exe",
        "${workspaceFolder}/build/debug/win_32/${fileBasenameNoExtension}.obj"
      ],
      "problemMatcher": {
        "pattern": {
          "regexp": "error"
        }
      }
    },

    {
      "label": "arch_os_16",
      "dependsOrder": "sequence",
      "dependsOn": ["arch_os_16_create", "arch_os_16_compile"]
    },
    {
      "label": "arch_os_16_create",
      "type": "shell",
      "command": "mkdir",
      "args": ["-p", "${workspaceFolder}/build/debug/os_16"],
      "presentation": {
        "focus": true,
        "panel": "shared",
        "reveal": "silent",
        "clear": true
      }
    },
    {
      "label": "arch_os_16_compile",
      "type": "shell",
      "command": "nasm",
      "args": [
        "-f",
        "bin",
        "-o",
        "${workspaceFolder}/build/debug/os_16/${fileBasenameNoExtension}.bin",
        "-MD",
        "${workspaceFolder}/build/debug/os_16/${fileBasenameNoExtension}.o.dep",
        "-l",
        "${workspaceFolder}/build/debug/os_16/${fileBasenameNoExtension}.o.lst",
        "-Dos_16",
        "${file}"
      ],
      "problemMatcher": {
        "pattern": {
          "regexp": "error"
        }
      }
    },

    {
      "label": "crateBuildFolder",
      "type": "shell",
      "command": "mkdir",
      "args": ["-p", "${workspaceFolder}/build/os"],
      "presentation": {
        "focus": true,
        "panel": "shared",
        "reveal": "silent",
        "clear": true
      }
    },
    {
      "label": "compileBoot",
      "type": "shell",
      "command": "nasm",
      "args": ["-f", "bin", "src/os/boot/mbr.asm", "-o", "build/os/boot.bin"],
      "dependsOn": ["crateBuildFolder"],
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },
    {
      "label": "compileKernel",
      "type": "shell",
      "command": "nasm",
      "args": [
        "-f",
        "bin",
        "src/os/kernel/main.asm",
        "-o",
        "build/os/kernel.bin"
      ],
      "dependsOn": ["crateBuildFolder"],
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },
    {
      "label": "createFlopyImage",
      "type": "shell",
      "command": "dd",
      "args": ["if=/dev/zero", "of=build/os/fda.img", "bs=512", "count=2880"],
      "dependsOn": ["crateBuildFolder"],
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },
    {
      "label": "createDiskImage",
      "type": "shell",
      "command": "dd",
      "args": ["if=/dev/zero", "of=build/os/hda.img", "bs=512", "count=2880"],
      "dependsOn": ["crateBuildFolder"],
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },
    {
      "label": "copyBootToImage",
      "type": "shell",
      "command": "dd",
      "args": [
        "if=build/os/boot.bin",
        "of=build/os/fda.img",
        "seek=0",
        "conv=notrunc"
      ],
      "dependsOn": ["compileBoot", "createFlopyImage", "createDiskImage"],
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },
    {
      "label": "copyKernelToImage",
      "type": "shell",
      "command": "dd",
      "args": [
        "if=build/os/kernel.bin",
        "of=build/os/fda.img",
        "seek=1",
        "conv=notrunc"
      ],
      "dependsOn": [
        "copyBootToImage",
        "compileKernel",
        "createFlopyImage",
        "createDiskImage"
      ],
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },
    {
      "label": "startQemu",
      "type": "shell",
      "command": "qemu-system-x86_64",
      "args": [
        "-machine",
        "q35",
        "-name",
        "Universe",
        "-m",
        "256",
        "-smp",
        "sockets=1,cpus=4",
        "-netdev",
        "socket,id=testnet,listen=:1234",
        "-device",
        "e1000,netdev=testnet,mac=10:11:12:13:14:15",
        "-drive",
        "id=disk0,file=build/os/hda.img,if=none,format=raw",
        "-fda",
        "build/os/fda.img",
        "-device",
        "ahci,id=ahci",
        "-device",
        "ide-hd,drive=disk0,bus=ahci.0",
        "-serial",
        "file:build/serial.log"
      ],
      "dependsOn": ["copyKernelToImage"],
      "group": {
        "kind": "build",
        "isDefault": true
      }
    }
  ]
}
